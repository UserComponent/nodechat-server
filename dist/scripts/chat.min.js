!function(e,t){var s,n,r,o;return o=t(),e(function(){var t,n,i,a,h,u,l;return t=e(window),n=e("#nc-message-form"),i=e("#nc-message-compose"),a=new s("#nc-messages-container"),h=e(".ns-chat-toggle"),l=h.filter('[name="toggle-theme"]'),u=h.filter('[name="toggle-sound"]'),h.bootstrapSwitch(),t.on("resize",function(){return a.resize()}),o.on("chat-message",function(e){return a.addMessage(e)}).on("chat-enter",function(e){return a.addMessage(e+" entered","text-muted nc-chat-enter-text")}).on("chat-exit",function(e){return a.addMessage(e+" left","text-muted nc-chat-exit-text")}),t.add(i).bind("keyup keydown keypress","ctrl+l",function(e){return e.preventDefault(),"keyup"===e.type?a.clear():void 0}),t.add(i).bind("keyup keydown keypress","ctrl+m",function(e){return e.preventDefault(),"keyup"===e.type?(a.soundsEnabled=!a.soundsEnabled,u.bootstrapSwitch("state",a.soundsEnabled,!0)):void 0}),n.on("submit",function(e){var t,s,n;if(e.preventDefault(),n=i.val(),""===n);else if(n.match(/^\/clear/))a.clear();else if(n.match(/^\/theme/)){if(s=n.split(" "),!s[1])return;if(s=s[1],r.set(s),"dark"!==s&&"light"!==s)return;l.bootstrapSwitch("state","dark"===s,!0)}else if(n.match(/^\/sounds?/)){if(t=n.split(" "),!t[1])return;if(t=t[1],"on"!==t&&"off"!==t)return;a.soundsEnabled="on"===t,u.bootstrapSwitch("state",a.soundsEnabled,!0)}else o.emit("chat-message",n);return i.val("")}),l.on("switchChange.bootstrapSwitch",function(e,t){return t===!0?r.set("dark"):r.set("light")}),u.on("switchChange.bootstrapSwitch",function(e,t){return t===!0?a.soundsEnabled=!0:a.soundsEnabled=!1})}),n=function(){function e(){}return e.hyperlinkTLD=["com","us","ca","net","eu","tv","gov","org"],e.tagHyperlinks=function(e){var t;return t=new RegExp("(https?\\:\\/\\/)?((?:www)?\\S+\\.(?:"+this.hyperlinkTLD.join("|")+")\\S*)","gi"),e.replace(t,'<a href="http://$2" target="_blank">$1$2</a>')},e}(),r=function(){function t(){}return t.stylesheetElement=e("#nc-chat-stylesheet"),t.stylesheets={light:"/styles/chat-light.min.css",dark:"/styles/chat-dark.min.css"},t.set=function(e){var t;return null!=this.stylesheets[e]?(this.stylesheetElement.attr("href",this.stylesheets[e]),t=!0):(console.error("stylesheet not found: "+e),t=!1),t},t}(),s=function(){function t(t){this.elem=e(t),this.pusher=null,this.resize(),this.clear()}return t.sounds={message:new Howl({urls:["/sounds/message.mp3","/sounds/message.m4a"]})},t.prototype.soundsEnabled=!0,t.prototype.resize=function(){var t;return t=e("#nc-message-form"),this.height=Math.ceil(t.offset().top)-16,this.height-=this.elem.offset().top,this.elem.css("height",this.height)},t.prototype.clear=function(){var t;return t=this.pusher,this.pusher=e(document.createElement("div")),this.pusher.addClass("nc-chat-buffer-pusher").height(this.height).appendTo(this.elem),this.scrollToBottom(),t?t.remove():void 0},t.prototype.addMessage=function(t,s){var r,o,i;return null==s&&(s=""),o=e(document.createElement("li")),i=null!=t.author?t.author+": "+t.content:t,r=n.tagHyperlinks(i),o.addClass(("nc-chat-message-item "+s).trim()).html(r).appendTo(this.elem),this.pusher&&this.pusher.height(Math.floor(this.pusher.height()-o.outerHeight(!0))),this.scrollToBottom(),t.author?this.playSound("message"):void 0},t.prototype.playSound=function(e){var s;return null!=t.sounds[e]?this.soundsEnabled?(t.sounds.message.play(),s=!0):s=!1:(console.error("sound not found: "+e),s=!1),s},t.prototype.scrollToBottom=function(){return this.elem.scrollTop(this.elem[0].scrollHeight)},t}()}(jQuery,io);